<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Installer l'Application - Un Loup-Garou a Eu</title>
  <link rel="stylesheet" href="style.css">

  <!-- PWA Meta tags -->
  <meta name="theme-color" content="#1f8a70">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Loup-Garou">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">

  <style>
    .install-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }

    .app-icon {
      width: 120px;
      height: 120px;
      margin: 30px auto;
      background: linear-gradient(135deg, #1f8a70, #166d5a);
      border-radius: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      box-shadow: 0 10px 30px rgba(31, 138, 112, 0.3);
    }

    .app-title {
      font-size: 28px;
      color: #1f8a70;
      margin: 20px 0;
      font-weight: bold;
    }

    .app-description {
      font-size: 16px;
      color: #c5c5c5;
      margin: 20px 0;
      line-height: 1.6;
    }

    .install-btn {
      background: linear-gradient(135deg, #1f8a70, #166d5a);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
      margin: 20px 10px;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(31, 138, 112, 0.3);
    }

    .install-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(31, 138, 112, 0.4);
    }

    .install-btn:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
    }

    .skip-btn {
      background: transparent;
      color: #1f8a70;
      border: 2px solid #1f8a70;
      padding: 12px 35px;
      font-size: 16px;
      border-radius: 12px;
      cursor: pointer;
      margin: 10px;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .skip-btn:hover {
      background: #1f8a70;
      color: white;
    }

    .features-list {
      text-align: left;
      margin: 30px auto;
      max-width: 400px;
    }

    .feature-item {
      display: flex;
      align-items: center;
      margin: 15px 0;
      padding: 15px;
      background: rgba(31, 138, 112, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(31, 138, 112, 0.3);
    }

    .feature-icon {
      font-size: 24px;
      margin-right: 15px;
      min-width: 30px;
    }

    .feature-text {
      font-size: 14px;
      color: #e0e0e0;
    }

    .status-message {
      padding: 12px 20px;
      border-radius: 8px;
      margin: 20px 0;
      font-size: 14px;
    }

    .status-info {
      background: rgba(31, 138, 112, 0.2);
      color: #1f8a70;
      border: 1px solid #1f8a70;
    }

    .status-success {
      background: rgba(31, 138, 112, 0.2);
      color: #1f8a70;
      border: 1px solid #1f8a70;
    }

    .status-warning {
      background: rgba(228, 63, 90, 0.2);
      color: #e43f5a;
      border: 1px solid #e43f5a;
    }

    .ios-instructions {
      margin: 30px 0;
      padding: 20px;
      background: rgba(31, 138, 112, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(31, 138, 112, 0.3);
    }

    .ios-instructions h3 {
      color: #1f8a70;
      margin-bottom: 15px;
    }

    .ios-instructions ol {
      text-align: left;
      margin: 0 auto;
      max-width: 400px;
      line-height: 1.8;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container install-container">
    <div class="app-icon">üê∫</div>

    <h1 class="app-title">Un Loup-Garou a Eu</h1>

    <p class="app-description">
      Installez l'application sur votre t√©l√©phone pour une meilleure exp√©rience de jeu !
      Acc√©dez rapidement √† vos missions et naviguez facilement vers les points d'int√©r√™t.
    </p>

    <!-- Message de statut -->
    <div id="statusMessage" class="status-message hidden"></div>

    <!-- Bouton d'installation (Android/Chrome) -->
    <div id="installSection">
      <button id="installBtn" class="install-btn">
        üì± Installer l'Application
      </button>
      <br>
      <a href="joueur.html" class="skip-btn">Continuer sans installer</a>
    </div>

    <!-- Instructions iOS -->
    <div id="iosInstructions" class="ios-instructions hidden">
      <h3>üì± Installation sur iPhone/iPad</h3>
      <ol>
        <li>Appuyez sur le bouton <strong>Partage</strong> ‚¨ÜÔ∏è</li>
        <li>Faites d√©filer et s√©lectionnez <strong>"Sur l'√©cran d'accueil"</strong></li>
        <li>Appuyez sur <strong>"Ajouter"</strong></li>
      </ol>
      <br>
      <a href="joueur.html" class="skip-btn">Continuer sans installer</a>
    </div>

    <!-- Fonctionnalit√©s -->
    <div class="features-list">
      <div class="feature-item">
        <div class="feature-icon">üó∫Ô∏è</div>
        <div class="feature-text">Navigation GPS vers les points d'int√©r√™t</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üì±</div>
        <div class="feature-text">Acc√®s rapide depuis votre √©cran d'accueil</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">‚ö°</div>
        <div class="feature-text">Chargement plus rapide</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üì¥</div>
        <div class="feature-text">Fonctionne m√™me hors ligne</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üéÆ</div>
        <div class="feature-text">Exp√©rience plein √©cran immersive</div>
      </div>
    </div>
  </div>

  <script>
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    const installSection = document.getElementById('installSection');
    const iosInstructions = document.getElementById('iosInstructions');
    const statusMessage = document.getElementById('statusMessage');

    // Fonction pour afficher un message de statut
    function showStatus(message, type = 'info') {
      statusMessage.textContent = message;
      statusMessage.className = `status-message status-${type}`;
      statusMessage.classList.remove('hidden');
    }

    // D√©tecter iOS
    function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    }

    // D√©tecter si l'app est d√©j√† install√©e
    function isAppInstalled() {
      return window.matchMedia('(display-mode: standalone)').matches ||
             window.navigator.standalone === true;
    }

    // V√©rifier le type d'appareil et afficher les instructions appropri√©es
    if (isAppInstalled()) {
      // L'app est d√©j√† install√©e
      showStatus('‚úÖ Application d√©j√† install√©e ! Redirection...', 'success');
      setTimeout(() => {
        window.location.href = 'joueur.html';
      }, 2000);
    } else if (isIOS()) {
      // Afficher les instructions iOS
      installSection.classList.add('hidden');
      iosInstructions.classList.remove('hidden');
      showStatus('‚ÑπÔ∏è Sur iOS, suivez les instructions ci-dessous', 'info');
    }

    // Capturer l'√©v√©nement beforeinstallprompt (Android/Chrome)
    window.addEventListener('beforeinstallprompt', (e) => {
      // Emp√™cher le mini-infobar par d√©faut
      e.preventDefault();
      // Sauvegarder l'√©v√©nement pour l'utiliser plus tard
      deferredPrompt = e;

      // Afficher le bouton d'installation
      installBtn.disabled = false;
      showStatus('‚ú® L\'application est pr√™te √† √™tre install√©e !', 'success');
    });

    // G√©rer le clic sur le bouton d'installation
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) {
        showStatus('‚ö†Ô∏è Installation non disponible sur cet appareil', 'warning');
        return;
      }

      // Afficher le prompt d'installation
      deferredPrompt.prompt();

      // Attendre que l'utilisateur r√©ponde au prompt
      const { outcome } = await deferredPrompt.userChoice;

      if (outcome === 'accepted') {
        showStatus('‚úÖ Installation en cours...', 'success');
        // Rediriger apr√®s l'installation
        setTimeout(() => {
          window.location.href = 'joueur.html';
        }, 1500);
      } else {
        showStatus('‚ÑπÔ∏è Installation annul√©e', 'info');
      }

      // R√©initialiser deferredPrompt
      deferredPrompt = null;
    });

    // D√©tecter si l'app a √©t√© install√©e avec succ√®s
    window.addEventListener('appinstalled', () => {
      showStatus('‚úÖ Application install√©e avec succ√®s !', 'success');
      setTimeout(() => {
        window.location.href = 'joueur.html';
      }, 2000);
    });

    // Si le prompt n'est pas disponible apr√®s 2 secondes
    setTimeout(() => {
      if (!deferredPrompt && !isIOS() && !isAppInstalled()) {
        showStatus('‚ÑπÔ∏è Installation automatique non disponible. Utilisez le menu de votre navigateur.', 'info');
      }
    }, 2000);

    // Enregistrer le Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('Service Worker enregistr√©:', registration.scope);
          })
          .catch((error) => {
            console.log('Erreur Service Worker:', error);
          });
      });
    }
  </script>
</body>
</html>
